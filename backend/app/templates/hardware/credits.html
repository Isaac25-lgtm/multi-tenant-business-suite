{% extends "base.html" %}

{% block title %}Hardware Credits - Devs APS{% endblock %}

{% block page_header %}
<h2>Hardware Credits</h2>
<p>{{ credits|length }} pending credits</p>
{% endblock %}

{% block content %}

<!-- Credits List -->
<div class="space-y-4">
    {% for credit in credits %}
    <div class="section-card">
        <div class="flex justify-between items-start">
            <div>
                <h3 class="font-semibold text-lg">{{ credit.reference_number }}</h3>
                <p class="text-gray-600">{{ credit.customer.name if credit.customer else 'Unknown Customer' }}</p>
                <p class="text-sm text-gray-500">{{ credit.sale_date.strftime('%Y-%m-%d') }}</p>
            </div>
            <div class="text-right">
                <div class="text-sm text-gray-500">Total: UGX {{ "{:,.0f}".format(credit.total_amount) }}</div>
                <div class="text-sm text-gray-500">Paid: UGX {{ "{:,.0f}".format(credit.amount_paid) }}</div>
                <div class="text-xl font-bold text-orange-600">Balance: UGX {{ "{:,.0f}".format(credit.balance) }}</div>
            </div>
        </div>

        <!-- Payment Form -->
        <form method="POST" action="{{ url_for('hardware.pay_credit', id=credit.id) }}" class="mt-4 pt-4 flex" style="border-top:1px solid var(--border); flex-wrap items-end gap-4">
            <div>
                <label class="form-label">Payment Amount</label>
                <input type="number" name="amount" min="1" max="{{ credit.balance }}" required class="form-input w-40" placeholder="Amount">
            </div>
            <div>
                <label class="form-label">Payment Date</label>
                <input type="date" name="payment_date" value="{{ today if today else '' }}" required class="form-input">
            </div>
            <button type="submit" class="btn btn-success">Record Payment</button>
            <a href="{{ url_for('hardware.view_sale', id=credit.id) }}" class="btn btn-outline">View Details</a>
        </form>
    </div>
    {% else %}
    <div class="section-card text-center" style="padding:32px;">
        <p class="text-gray-500">No pending credits</p>
    </div>
    {% endfor %}
</div>
{% endblock %}
